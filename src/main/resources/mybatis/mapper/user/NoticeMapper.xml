<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper 
	PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" 
	"http://mybatis.org/dtd/mybatis-3-mapper.dtd" >

<mapper namespace="com.vvs.platform.dao.user.UserNoticeDAO">
	<select id="selectNoticeList" resultType="com.vvs.platform.dto.user.NoticeDTO">
		SELECT * FROM notices order by seq_notices desc
	</select>
	
	<!-- 카테고리에 맞춘 페이징된 글 목록 가져옴  -->
	<select id="getNoticeList" resultType="com.vvs.platform.dto.user.NoticeDTO" parameterType="java.util.Map">
		SELECT * FROM notices
		<where>
			<if test="category != null and category != '' and category != 'all'" >
				category = #{category}
			</if>
		</where>
		ORDER BY seq_notices DESC
		OFFSET #{offset} ROWS FETCH NEXT #{limit} ROWS ONLY
	</select>
	
	<!-- category에 따른 전체 글 수   -->
	<select id="getNoticeTotalCount" resultType="int" parameterType="String">
		SELECT COUNT(*) FROM notices 
		<where>
			<if test="category != null and category != '' and category != 'all'">
				category = #{category} 
			</if>
		</where>
	</select>
	
	<!-- 특정 번호의 공지사항 하나의 정보 가져옴 -->
	<select id="getNoticeById" resultType="com.vvs.platform.dto.user.NoticeDTO" parameterType="int">
		SELECT * FROM notices WHERE seq_notices = #{noticeSeq}
	</select>
	
	<!-- 이전글 제목, 번호 -->
	<select id="getPrevNotice" resultType="com.vvs.platform.dto.user.NoticeDTO" parameterType="int">
		<![CDATA[
		SELECT * FROM notices
	    WHERE seq_notices > #{noticeSeq}
	    ORDER BY seq_notices ASC
	    FETCH FIRST 1 ROWS ONLY
		]]>
	</select>
	
	<!-- 다음글 제목, 번호 -->
	<select id="getNextNotice" resultType="com.vvs.platform.dto.user.NoticeDTO" parameterType="int">
		<![CDATA[
		SELECT * FROM notices
	    WHERE seq_notices < #{noticeSeq}
	    ORDER BY seq_notices DESC
	    FETCH FIRST 1 ROWS ONLY
	    ]]>
	</select>
	
	<!-- 조회수 증가 -->
	<update id="incrementViewCount" parameterType="int">
		UPDATE notices SET VIEWNUM = VIEWNUM+1 WHERE SEQ_NOTICES = #{noticeSeq}
	</update>
</mapper>
